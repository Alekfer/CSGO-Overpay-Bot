var SteamUser=require("steam-user"),client=new SteamUser,TradeOfferManager=require("steam-tradeoffer-manager"),config=require("./config.json"),SteamTotp=require("steam-totp"),SteamCommunity=require("steamcommunity"),community=new SteamCommunity,fs=require("fs"),manager=new TradeOfferManager({steam:client,domain:"example.com",language:"en"}),request=require("request"),url="https://api.csgofast.com/price/all";
function getPrice(){request(url,function(a,b,c){a||200!==b.statusCode?console.log("Got an error: ",a,", status code: ",b.statusCode):(JSON.parse(c),fs.writeFile("prices.json",c))})}getPrice();setInterval(function(){getPrice()},3E4);function logOn(){client.logOn({accountName:config.username,password:config.password,twoFactorCode:SteamTotp.generateAuthCode(config.sharedSecret)})}logOn();client.on("webSession",function(a,b){manager.setCookies(b,function(a){a&&(console.log(a),process.exit(1))})});
manager.on("pollData",function(a){fs.writeFile("polldata.json",JSON.stringify(a))});fs.existsSync("polldata.json")&&(manager.pollData=JSON.parse(fs.readFileSync("polldata.json")));client.on("loggedOn",function(a){console.log("Logged into Steam as "+client.steamID.getSteam3RenderedID());client.setPersona(SteamUser.EPersonaState.Online)});manager=new TradeOfferManager({steam:client,domain:"nothinghere",language:"en"});
client.on("webSession",function(a,b){manager.setCookies(b,function(a){a?(console.log(a),process.exit(1)):console.log("Got API key: "+manager.apiKey)});community.setCookies(b);community.startConfirmationChecker(3E4,config.identitySecret)});function exists(a){for(;0<config.acceptSteamIDS.length;)return config.acceptSteamIDS[0]==a?!0:!1}function getPrices(a){var b=require("./prices.json"),c=0;null==a&&(a={market_hash_name:200});for(var d=0;d<a.length;d++)c+=b[a[d].market_hash_name];return c}
manager.on("newOffer",function(a){function b(){a.accept(function(a){a?console.log("Unable to accept offer: "+a.message):community.checkConfirmations()})}var c=a.partner.getSteamID64();console.log("New offer #"+a.id+" from "+c);0==a.itemsToGive.length?(client.chatMessage(c,config.options.chatResponse.donation),console.log(c+" Just Donated us skins!"),b()):getPrices(a.itemsToGive)>getPrices(a.itemsToReceive)*config.options.percentamount?(client.chatMessage(c,config.options.chatResponse.tradeDeclined),
a.decline(function(a){a&&console.log("Unable to decline offer: "+a.message)})):getPrices(a.itemsToGive)<getPrices(a.itemsToReceive)*config.options.percentamount&&(client.chatMessage(c,config.options.chatResponse.tradeAccepted),b())});
